version: '2.2'
services:
  transmission:
    image: "haugene/transmission-openvpn"
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    ports:
     - "9999:9999" #web proxy
    expose:
     - "9091"
    volumes:
     - transmission_completed_downloads:/data/complete
     - transmission_watch:/data/watch
    environment:
      - OPENVPN_PROVIDER=${VPN_OPENVPN_PROVIDER:-SUBFAIL}
      - OPENVPN_CONFIG=${VPN_OPENVPN_CONFIG:-SUBFAIL}
      - OPENVPN_USERNAME=${VPN_OPENVPN_USERNAME:-SUBFAIL}
      - OPENVPN_PASSWORD=${VPN_OPENVPN_PASSWORD:-SUBFAIL}
      - OPENVPN_OPTS=--pull-filter ignore ping
      - TRANSMISSION_UMASK=0
      - TRANSMISSION_DOWNLOAD_DIR=/data/complete
      - TRANSMISSION_WATCH_DIR=/data/watch
      - TRANSMISSION_WATCH_DIR_ENABLED=true
      - TRANSMISSION_SPEED_LIMIT_UP_ENABLED=true
      - TRANSMISSION_SPEED_LIMIT_UP=50
      - TRANSMISSION_DOWNLOAD_QUEUE_SIZE=3
      - TRANSMISSION_DOWNLOAD_QUEUE_ENABLED=true
      - TRANSMISSION_RATIO_LIMIT_ENABLED=true
      - TRANSMISSION_RATIO_LIMIT=1
      - TRANSMISSION_SPEED_LIMIT_DOWN_ENABLED=false
      - TRANSMISSION_SPEED_LIMIT_DOWN=100
      - WEBPROXY_ENABLED=true
      - WEBPROXY_PORT=9999
      - TZ=${MY_TZ:-SUBFAIL}
      - VIRTUAL_PORT=9091
      - VIRTUAL_HOST=transmission.${DNS_SUFFIX:-local}
      - LETSENCRYPT_HOST=transmission.${DNS_SUFFIX:-local}
      - LETSENCRYPT_EMAIL=${LETS_ENC_EMAIL:-SUBFAIL}
    networks:
      - reverse-proxy
    labels:
      container_group: plex

networks:
  reverse-proxy:
    external:
      name: reverse-proxy

volumes:
  transmission_completed_downloads:
    driver: "local"
    driver_opts:
      device: "${VOL_DEVICE_PREFIX:-SUBFAIL}/scratch/!torrent"
      type: ${VOL_TYPE:-SUBFAIL}
      o: ${VOL_OPS:-SUBFAIL}
  transmission_watch:
    driver: "local"
    driver_opts:
      device: "${VOL_DEVICE_PREFIX:-SUBFAIL}/scratch/!torrent/!watch"
      type: ${VOL_TYPE:-SUBFAIL}
      o: ${VOL_OPS:-SUBFAIL}
